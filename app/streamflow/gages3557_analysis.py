import os
import torch
import sys

sys.path.append("../..")
import definitions
from data.pro.data_gages_pro import GagesPro
from data.cache.cache_factory import cache_dataset
from data.config import default_config_file, cmd, update_cfg
from hydroDL.trainer import train_and_evaluate


def main(config_data, args):
    """
    Main function which is called from the command line. Entrypoint for training all ML models.
    """
    update_cfg(config_data, args)
    if config_data["dataset_params"]["cache_write"]:
        dataset_params = config_data["dataset_params"]
        dataset = GagesPro(dataset_params["data_path"], dataset_params["download"])
        cache_dataset(dataset_params, dataset)

    with torch.cuda.device(0):
        train_and_evaluate(config_data)
    print("Process is now complete.")


# python gages3557_analysis.py --sub test/exp2 --download 0 --model_name KuaiLSTM --opt Adadelta --rs 1234 --cache_write 1 --train_period 1992-01-01 1994-01-01 --test_period 1995-10-01 1996-10-01 --scaler DapengScaler --data_loader StreamflowDataModel --train_epoch 10 --batch_size 5 --rho 20 --var_c DRAIN_SQKM ELEV_MEAN_M_BASIN SLOPE_PCT DEVNLCD06 FORESTNLCD06 PLANTNLCD06 WATERNLCD06 SNOWICENLCD06 BARRENNLCD06 SHRUBNLCD06 GRASSNLCD06 WOODYWETNLCD06 EMERGWETNLCD06 AWCAVE PERMAVE RFACT ROCKDEPAVE GEOL_REEDBUSH_DOM GEOL_REEDBUSH_DOM_PCT STREAMS_KM_SQ_KM NDAMS_2009 STOR_NOR_2009 RAW_DIS_NEAREST_MAJ_DAM CANALS_PCT RAW_DIS_NEAREST_CANAL FRESHW_WITHDRAWAL POWER_SUM_MW PDEN_2000_BLOCK ROADS_KM_SQ_KM IMPNLCD06 --n_feature 37 --gage_id 01013500 01022500 01030500 01031500 01047000 01052500 01054200 01055000 01057000 01170100
# python gages3557_analysis.py --sub gages/cache-3557sites-19900101_20000101_20000101_20100101-30attr-7forcing --download 0 --model_name KuaiLSTM --opt Adadelta --loss_func RMSESum  --hidden_size 256 --rs 1234 --train_mode 0 --cache_write 1 --train_period 1990-01-01 2000-01-01 --test_period 2000-01-01 2010-01-01 --scaler DapengScaler --data_loader StreamflowDataModel --train_epoch 300 --save_epoch 50 --batch_size 100 --rho 365 --var_c DRAIN_SQKM ELEV_MEAN_M_BASIN SLOPE_PCT DEVNLCD06 FORESTNLCD06 PLANTNLCD06 WATERNLCD06 SNOWICENLCD06 BARRENNLCD06 SHRUBNLCD06 GRASSNLCD06 WOODYWETNLCD06 EMERGWETNLCD06 AWCAVE PERMAVE RFACT ROCKDEPAVE GEOL_REEDBUSH_DOM GEOL_REEDBUSH_DOM_PCT STREAMS_KM_SQ_KM NDAMS_2009 STOR_NOR_2009 RAW_DIS_NEAREST_MAJ_DAM CANALS_PCT RAW_DIS_NEAREST_CANAL FRESHW_WITHDRAWAL POWER_SUM_MW PDEN_2000_BLOCK ROADS_KM_SQ_KM IMPNLCD06 --n_feature 37 --gage_id_file /mnt/data/owen411/code/hydro-spdb-dl/example/3557basins_ID_NSE_DOR.csv
# python gages3557_analysis.py --sub gages/exp2 --download 0 --model_name KuaiLSTM --opt Adadelta --loss_func RMSESum  --hidden_size 256 --rs 1234 --cache_read 1 --cache_path /mnt/data/owen411/code/hydro-spdb-dl/example/gages/cache-3557sites-19900101_20000101_20000101_20100101-30attr-7forcing --train_period 1990-01-01 2000-01-01 --test_period 2000-01-01 2010-01-01 --scaler DapengScaler --data_loader StreamflowDataModel --train_epoch 300 --save_epoch 50 --batch_size 100 --rho 365 --var_c DRAIN_SQKM ELEV_MEAN_M_BASIN SLOPE_PCT DEVNLCD06 FORESTNLCD06 PLANTNLCD06 WATERNLCD06 SNOWICENLCD06 BARRENNLCD06 SHRUBNLCD06 GRASSNLCD06 WOODYWETNLCD06 EMERGWETNLCD06 AWCAVE PERMAVE RFACT ROCKDEPAVE GEOL_REEDBUSH_DOM GEOL_REEDBUSH_DOM_PCT STREAMS_KM_SQ_KM NDAMS_2009 STOR_NOR_2009 RAW_DIS_NEAREST_MAJ_DAM CANALS_PCT RAW_DIS_NEAREST_CANAL FRESHW_WITHDRAWAL POWER_SUM_MW PDEN_2000_BLOCK ROADS_KM_SQ_KM IMPNLCD06 --n_feature 37 --gage_id_file /mnt/data/owen411/code/hydro-spdb-dl/example/3557basins_ID_NSE_DOR.csv
# python gages3557_analysis.py --sub gages/exp3 --download 0 --model_name KuaiLSTM --opt Adadelta --loss_func RMSESum  --hidden_size 256 --rs 123 --cache_read 1 --cache_path /mnt/data/owen411/code/hydro-spdb-dl/example/gages/cache-3557sites-19900101_20000101_20000101_20100101-30attr-7forcing --train_period 1990-01-01 2000-01-01 --test_period 2000-01-01 2010-01-01 --scaler DapengScaler --data_loader StreamflowDataModel --train_epoch 300 --save_epoch 50 --batch_size 100 --rho 365 --var_c DRAIN_SQKM ELEV_MEAN_M_BASIN SLOPE_PCT DEVNLCD06 FORESTNLCD06 PLANTNLCD06 WATERNLCD06 SNOWICENLCD06 BARRENNLCD06 SHRUBNLCD06 GRASSNLCD06 WOODYWETNLCD06 EMERGWETNLCD06 AWCAVE PERMAVE RFACT ROCKDEPAVE GEOL_REEDBUSH_DOM GEOL_REEDBUSH_DOM_PCT STREAMS_KM_SQ_KM NDAMS_2009 STOR_NOR_2009 RAW_DIS_NEAREST_MAJ_DAM CANALS_PCT RAW_DIS_NEAREST_CANAL FRESHW_WITHDRAWAL POWER_SUM_MW PDEN_2000_BLOCK ROADS_KM_SQ_KM IMPNLCD06 --n_feature 37 --gage_id_file /mnt/data/owen411/code/hydro-spdb-dl/example/3557basins_ID_NSE_DOR.csv
# python gages3557_analysis.py --sub gages/exp4 --download 0 --model_name KuaiLSTM --opt Adadelta --loss_func RMSESum  --hidden_size 256 --rs 12345 --cache_read 1 --cache_path /mnt/data/owen411/code/hydro-spdb-dl/example/gages/cache-3557sites-19900101_20000101_20000101_20100101-30attr-7forcing --train_period 1990-01-01 2000-01-01 --test_period 2000-01-01 2010-01-01 --scaler DapengScaler --data_loader StreamflowDataModel --train_epoch 300 --save_epoch 50 --batch_size 100 --rho 365 --var_c DRAIN_SQKM ELEV_MEAN_M_BASIN SLOPE_PCT DEVNLCD06 FORESTNLCD06 PLANTNLCD06 WATERNLCD06 SNOWICENLCD06 BARRENNLCD06 SHRUBNLCD06 GRASSNLCD06 WOODYWETNLCD06 EMERGWETNLCD06 AWCAVE PERMAVE RFACT ROCKDEPAVE GEOL_REEDBUSH_DOM GEOL_REEDBUSH_DOM_PCT STREAMS_KM_SQ_KM NDAMS_2009 STOR_NOR_2009 RAW_DIS_NEAREST_MAJ_DAM CANALS_PCT RAW_DIS_NEAREST_CANAL FRESHW_WITHDRAWAL POWER_SUM_MW PDEN_2000_BLOCK ROADS_KM_SQ_KM IMPNLCD06 --n_feature 37 --gage_id_file /mnt/data/owen411/code/hydro-spdb-dl/example/3557basins_ID_NSE_DOR.csv
# python gages3557_analysis.py --sub gages/exp5 --download 0 --model_name KuaiLSTM --opt Adadelta --loss_func RMSESum  --hidden_size 256 --rs 111 --cache_read 1 --cache_path /mnt/data/owen411/code/hydro-spdb-dl/example/gages/cache-3557sites-19900101_20000101_20000101_20100101-30attr-7forcing --train_period 1990-01-01 2000-01-01 --test_period 2000-01-01 2010-01-01 --scaler DapengScaler --data_loader StreamflowDataModel --train_epoch 300 --save_epoch 50 --batch_size 100 --rho 365 --var_c DRAIN_SQKM ELEV_MEAN_M_BASIN SLOPE_PCT DEVNLCD06 FORESTNLCD06 PLANTNLCD06 WATERNLCD06 SNOWICENLCD06 BARRENNLCD06 SHRUBNLCD06 GRASSNLCD06 WOODYWETNLCD06 EMERGWETNLCD06 AWCAVE PERMAVE RFACT ROCKDEPAVE GEOL_REEDBUSH_DOM GEOL_REEDBUSH_DOM_PCT STREAMS_KM_SQ_KM NDAMS_2009 STOR_NOR_2009 RAW_DIS_NEAREST_MAJ_DAM CANALS_PCT RAW_DIS_NEAREST_CANAL FRESHW_WITHDRAWAL POWER_SUM_MW PDEN_2000_BLOCK ROADS_KM_SQ_KM IMPNLCD06 --n_feature 37 --gage_id_file /mnt/data/owen411/code/hydro-spdb-dl/example/3557basins_ID_NSE_DOR.csv
# python gages3557_analysis.py --sub gages/exp6 --download 0 --model_name KuaiLSTM --opt Adadelta --loss_func RMSESum  --hidden_size 256 --rs 11111 --cache_read 1 --cache_path /mnt/data/owen411/code/hydro-spdb-dl/example/gages/cache-3557sites-19900101_20000101_20000101_20100101-30attr-7forcing --train_period 1990-01-01 2000-01-01 --test_period 2000-01-01 2010-01-01 --scaler DapengScaler --data_loader StreamflowDataModel --train_epoch 300 --save_epoch 50 --batch_size 100 --rho 365 --var_c DRAIN_SQKM ELEV_MEAN_M_BASIN SLOPE_PCT DEVNLCD06 FORESTNLCD06 PLANTNLCD06 WATERNLCD06 SNOWICENLCD06 BARRENNLCD06 SHRUBNLCD06 GRASSNLCD06 WOODYWETNLCD06 EMERGWETNLCD06 AWCAVE PERMAVE RFACT ROCKDEPAVE GEOL_REEDBUSH_DOM GEOL_REEDBUSH_DOM_PCT STREAMS_KM_SQ_KM NDAMS_2009 STOR_NOR_2009 RAW_DIS_NEAREST_MAJ_DAM CANALS_PCT RAW_DIS_NEAREST_CANAL FRESHW_WITHDRAWAL POWER_SUM_MW PDEN_2000_BLOCK ROADS_KM_SQ_KM IMPNLCD06 --n_feature 37 --gage_id_file /mnt/data/owen411/code/hydro-spdb-dl/example/3557basins_ID_NSE_DOR.csv
# python gages3557_analysis.py --sub gages/exp7 --download 0 --weight_path /mnt/data/owen411/code/hydro-spdb-dl/example/gages/exp7/08_April_202108_54PM_model.pth --model_name KuaiLSTM --opt Adadelta --loss_func RMSESum  --hidden_size 256 --rs 1111 --cache_read 1 --cache_path /mnt/data/owen411/code/hydro-spdb-dl/example/gages/cache-3557sites-19900101_20000101_20000101_20100101-30attr-7forcing --train_period 1990-01-01 2000-01-01 --test_period 2000-01-01 2010-01-01 --scaler DapengScaler --data_loader StreamflowDataModel --train_epoch 300 --save_epoch 50 --batch_size 100 --rho 365 --var_c DRAIN_SQKM ELEV_MEAN_M_BASIN SLOPE_PCT DEVNLCD06 FORESTNLCD06 PLANTNLCD06 WATERNLCD06 SNOWICENLCD06 BARRENNLCD06 SHRUBNLCD06 GRASSNLCD06 WOODYWETNLCD06 EMERGWETNLCD06 AWCAVE PERMAVE RFACT ROCKDEPAVE GEOL_REEDBUSH_DOM GEOL_REEDBUSH_DOM_PCT STREAMS_KM_SQ_KM NDAMS_2009 STOR_NOR_2009 RAW_DIS_NEAREST_MAJ_DAM CANALS_PCT RAW_DIS_NEAREST_CANAL FRESHW_WITHDRAWAL POWER_SUM_MW PDEN_2000_BLOCK ROADS_KM_SQ_KM IMPNLCD06 --n_feature 37 --gage_id_file /mnt/data/owen411/code/hydro-spdb-dl/example/3557basins_ID_NSE_DOR.csv
# python gages3557_analysis.py --sub gages/exp8 --gage_id_file /mnt/data/owen411/code/hydro-spdb-dl/example/3557basins_ID_NSE_DOR.csv --download 0 --model_name LSTMKernel --opt Adadelta --loss_func RMSESum --rs 1234 --model_param {\"nx\":37\,\"ny\":1\,\"hidden_size\":256\,\"nk\":1\,\"hidden_size_later\":256\,\"cut\":false\,\"dr\":0.5} --cache_read 1 --cache_path /mnt/data/owen411/code/hydro-spdb-dl/example/gages/cache-3557sites-19900101_20000101_20000101_20100101-30attr-7forcing --train_period 1990-01-01 2000-01-01 --test_period 2000-01-01 2010-01-01 --scaler DapengScaler --data_loader StreamflowDataModel --train_epoch 300 --save_epoch 50 --batch_size 100 --rho 365 --var_c DRAIN_SQKM ELEV_MEAN_M_BASIN SLOPE_PCT DEVNLCD06 FORESTNLCD06 PLANTNLCD06 WATERNLCD06 SNOWICENLCD06 BARRENNLCD06 SHRUBNLCD06 GRASSNLCD06 WOODYWETNLCD06 EMERGWETNLCD06 AWCAVE PERMAVE RFACT ROCKDEPAVE GEOL_REEDBUSH_DOM GEOL_REEDBUSH_DOM_PCT STREAMS_KM_SQ_KM NDAMS_2009 STOR_NOR_2009 RAW_DIS_NEAREST_MAJ_DAM CANALS_PCT RAW_DIS_NEAREST_CANAL FRESHW_WITHDRAWAL POWER_SUM_MW PDEN_2000_BLOCK ROADS_KM_SQ_KM IMPNLCD06 --n_feature 37
# python gages3557_analysis.py --sub gages/exp9 --gage_id_file /mnt/data/owen411/code/hydro-spdb-dl/example/3557basins_ID_NSE_DOR.csv --download 0 --model_name LSTMKernel --opt Adadelta --loss_func RMSESum --rs 1234 --model_param {\"nx\":37\,\"ny\":1\,\"hidden_size\":256\,\"nk\":1\,\"hidden_size_later\":256\,\"cut\":false\,\"dr\":0.5\,\"delta_s\":true} --cache_read 1 --cache_path /mnt/data/owen411/code/hydro-spdb-dl/example/gages/cache-3557sites-19900101_20000101_20000101_20100101-30attr-7forcing --train_period 1990-01-01 2000-01-01 --test_period 2000-01-01 2010-01-01 --scaler DapengScaler --data_loader StreamflowDataModel --train_epoch 300 --save_epoch 50 --batch_size 100 --rho 365 --var_c DRAIN_SQKM ELEV_MEAN_M_BASIN SLOPE_PCT DEVNLCD06 FORESTNLCD06 PLANTNLCD06 WATERNLCD06 SNOWICENLCD06 BARRENNLCD06 SHRUBNLCD06 GRASSNLCD06 WOODYWETNLCD06 EMERGWETNLCD06 AWCAVE PERMAVE RFACT ROCKDEPAVE GEOL_REEDBUSH_DOM GEOL_REEDBUSH_DOM_PCT STREAMS_KM_SQ_KM NDAMS_2009 STOR_NOR_2009 RAW_DIS_NEAREST_MAJ_DAM CANALS_PCT RAW_DIS_NEAREST_CANAL FRESHW_WITHDRAWAL POWER_SUM_MW PDEN_2000_BLOCK ROADS_KM_SQ_KM IMPNLCD06 --n_feature 37
# python gages3557_analysis.py --sub gages/cache-3557sites-19900101_20000101_20000101_20100101-30attr-7forcing-res_stor_hist --gage_id_file /mnt/data/owen411/code/hydro-spdb-dl/example/3557basins_ID_NSE_DOR.csv --download 0 --model_name DapengCNNLSTM --opt Adadelta --loss_func RMSESum --rs 1234 --model_param {\"n_kernel\":[10\,5]\,\"kernel_size\":[3\,3]\,\"stride\":[2\,1]\,\"nx\":37\,\"ny\":1\,\"nobs\":50\,\"hidden_size\":256\,\"dr\":0.5\,\"cnn_dr\":0.5\,\"cat_first\":true} --cache_write 1 --train_mode 0 --train_period 1990-01-01 2000-01-01 --test_period 2000-01-01 2010-01-01 --scaler DapengScaler --data_loader KernelFlowDataModel --train_epoch 300 --save_epoch 50 --batch_size 100 --rho 365 --var_o {\"RES_STOR_HIST\":{\"bins\":50}} --var_c DRAIN_SQKM ELEV_MEAN_M_BASIN SLOPE_PCT DEVNLCD06 FORESTNLCD06 PLANTNLCD06 WATERNLCD06 SNOWICENLCD06 BARRENNLCD06 SHRUBNLCD06 GRASSNLCD06 WOODYWETNLCD06 EMERGWETNLCD06 AWCAVE PERMAVE RFACT ROCKDEPAVE GEOL_REEDBUSH_DOM GEOL_REEDBUSH_DOM_PCT STREAMS_KM_SQ_KM NDAMS_2009 STOR_NOR_2009 RAW_DIS_NEAREST_MAJ_DAM CANALS_PCT RAW_DIS_NEAREST_CANAL FRESHW_WITHDRAWAL POWER_SUM_MW PDEN_2000_BLOCK ROADS_KM_SQ_KM IMPNLCD06
# python gages3557_analysis.py --sub gages/exp10 --gage_id_file /mnt/data/owen411/code/hydro-spdb-dl/example/3557basins_ID_NSE_DOR.csv --download 0 --model_name DapengCNNLSTM --opt Adadelta --loss_func RMSESum --rs 1234 --model_param {\"n_kernel\":[10\,5]\,\"kernel_size\":[3\,3]\,\"stride\":[2\,1]\,\"nx\":37\,\"ny\":1\,\"nobs\":50\,\"hidden_size\":256\,\"dr\":0.5\,\"cnn_dr\":0.5\,\"cat_first\":true} --cache_read 1 --cache_path /mnt/data/owen411/code/hydro-spdb-dl/example/gages/cache-3557sites-19900101_20000101_20000101_20100101-30attr-7forcing-res_stor_hist --train_period 1990-01-01 2000-01-01 --test_period 2000-01-01 2010-01-01 --scaler DapengScaler --data_loader KernelFlowDataModel --train_epoch 300 --save_epoch 50 --batch_size 100 --rho 365 --var_o {\"RES_STOR_HIST\":{\"bins\":50}} --var_c DRAIN_SQKM ELEV_MEAN_M_BASIN SLOPE_PCT DEVNLCD06 FORESTNLCD06 PLANTNLCD06 WATERNLCD06 SNOWICENLCD06 BARRENNLCD06 SHRUBNLCD06 GRASSNLCD06 WOODYWETNLCD06 EMERGWETNLCD06 AWCAVE PERMAVE RFACT ROCKDEPAVE GEOL_REEDBUSH_DOM GEOL_REEDBUSH_DOM_PCT STREAMS_KM_SQ_KM NDAMS_2009 STOR_NOR_2009 RAW_DIS_NEAREST_MAJ_DAM CANALS_PCT RAW_DIS_NEAREST_CANAL FRESHW_WITHDRAWAL POWER_SUM_MW PDEN_2000_BLOCK ROADS_KM_SQ_KM IMPNLCD06
# python gages3557_analysis.py --sub gages/exp11 --gage_id_file /mnt/data/owen411/code/hydro-spdb-dl/example/3557basins_ID_NSE_DOR.csv --download 0 --model_name DapengCNNLSTM --opt Adadelta --loss_func RMSESum --rs 1234 --model_param {\"n_kernel\":[10\,5]\,\"kernel_size\":[3\,3]\,\"stride\":[2\,1]\,\"nx\":37\,\"ny\":1\,\"nobs\":50\,\"hidden_size\":256\,\"dr\":0.5\,\"cnn_dr\":0.5\,\"cat_first\":false} --cache_read 1 --cache_path /mnt/data/owen411/code/hydro-spdb-dl/example/gages/cache-3557sites-19900101_20000101_20000101_20100101-30attr-7forcing-res_stor_hist --train_period 1990-01-01 2000-01-01 --test_period 2000-01-01 2010-01-01 --scaler DapengScaler --data_loader KernelFlowDataModel --train_epoch 300 --save_epoch 50 --batch_size 100 --rho 365 --var_o {\"RES_STOR_HIST\":{\"bins\":50}} --var_c DRAIN_SQKM ELEV_MEAN_M_BASIN SLOPE_PCT DEVNLCD06 FORESTNLCD06 PLANTNLCD06 WATERNLCD06 SNOWICENLCD06 BARRENNLCD06 SHRUBNLCD06 GRASSNLCD06 WOODYWETNLCD06 EMERGWETNLCD06 AWCAVE PERMAVE RFACT ROCKDEPAVE GEOL_REEDBUSH_DOM GEOL_REEDBUSH_DOM_PCT STREAMS_KM_SQ_KM NDAMS_2009 STOR_NOR_2009 RAW_DIS_NEAREST_MAJ_DAM CANALS_PCT RAW_DIS_NEAREST_CANAL FRESHW_WITHDRAWAL POWER_SUM_MW PDEN_2000_BLOCK ROADS_KM_SQ_KM IMPNLCD06
# python gages3557_analysis.py --sub gages/cache-3557sites-19900101_20000101_20000101_20100101-30attr-7forcing-res_dor_hist --gage_id_file /mnt/data/owen411/code/hydro-spdb-dl/example/3557basins_ID_NSE_DOR.csv --download 0 --model_name DapengCNNLSTM --opt Adadelta --loss_func RMSESum --rs 1234 --model_param {\"n_kernel\":[10\,5]\,\"kernel_size\":[3\,3]\,\"stride\":[2\,1]\,\"nx\":37\,\"ny\":1\,\"nobs\":50\,\"hidden_size\":256\,\"dr\":0.5\,\"cnn_dr\":0.5\,\"cat_first\":true} --cache_write 1 --train_mode 0 --train_period 1990-01-01 2000-01-01 --test_period 2000-01-01 2010-01-01 --scaler DapengScaler --data_loader KernelFlowDataModel --train_epoch 300 --save_epoch 50 --batch_size 100 --rho 365 --var_o {\"RES_DOR_HIST\":{\"bins\":50}} --var_c DRAIN_SQKM ELEV_MEAN_M_BASIN SLOPE_PCT DEVNLCD06 FORESTNLCD06 PLANTNLCD06 WATERNLCD06 SNOWICENLCD06 BARRENNLCD06 SHRUBNLCD06 GRASSNLCD06 WOODYWETNLCD06 EMERGWETNLCD06 AWCAVE PERMAVE RFACT ROCKDEPAVE GEOL_REEDBUSH_DOM GEOL_REEDBUSH_DOM_PCT STREAMS_KM_SQ_KM NDAMS_2009 STOR_NOR_2009 RAW_DIS_NEAREST_MAJ_DAM CANALS_PCT RAW_DIS_NEAREST_CANAL FRESHW_WITHDRAWAL POWER_SUM_MW PDEN_2000_BLOCK ROADS_KM_SQ_KM IMPNLCD06
# python gages3557_analysis.py --sub gages/exp12 --gage_id_file /mnt/data/owen411/code/hydro-spdb-dl/example/3557basins_ID_NSE_DOR.csv --download 0 --model_name DapengCNNLSTM --opt Adadelta --loss_func RMSESum --rs 1234 --model_param {\"n_kernel\":[10\,5]\,\"kernel_size\":[3\,3]\,\"stride\":[2\,1]\,\"nx\":37\,\"ny\":1\,\"nobs\":50\,\"hidden_size\":256\,\"dr\":0.5\,\"cnn_dr\":0.5\,\"cat_first\":true} --cache_read 1 --cache_path /mnt/data/owen411/code/hydro-spdb-dl/example/gages/cache-3557sites-19900101_20000101_20000101_20100101-30attr-7forcing-res_dor_hist --train_period 1990-01-01 2000-01-01 --test_period 2000-01-01 2010-01-01 --scaler DapengScaler --data_loader KernelFlowDataModel --train_epoch 300 --save_epoch 50 --batch_size 100 --rho 365 --var_o {\"RES_DOR_HIST\":{\"bins\":50}} --var_c DRAIN_SQKM ELEV_MEAN_M_BASIN SLOPE_PCT DEVNLCD06 FORESTNLCD06 PLANTNLCD06 WATERNLCD06 SNOWICENLCD06 BARRENNLCD06 SHRUBNLCD06 GRASSNLCD06 WOODYWETNLCD06 EMERGWETNLCD06 AWCAVE PERMAVE RFACT ROCKDEPAVE GEOL_REEDBUSH_DOM GEOL_REEDBUSH_DOM_PCT STREAMS_KM_SQ_KM NDAMS_2009 STOR_NOR_2009 RAW_DIS_NEAREST_MAJ_DAM CANALS_PCT RAW_DIS_NEAREST_CANAL FRESHW_WITHDRAWAL POWER_SUM_MW PDEN_2000_BLOCK ROADS_KM_SQ_KM IMPNLCD06
# python gages3557_analysis.py --sub gages/exp13 --gage_id_file /mnt/data/owen411/code/hydro-spdb-dl/example/3557basins_ID_NSE_DOR.csv --download 0 --model_name DapengCNNLSTM --opt Adadelta --loss_func RMSESum --rs 1234 --model_param {\"n_kernel\":[10\,5]\,\"kernel_size\":[3\,3]\,\"stride\":[2\,1]\,\"nx\":37\,\"ny\":1\,\"nobs\":50\,\"hidden_size\":256\,\"dr\":0.5\,\"cnn_dr\":0.5\,\"cat_first\":false} --cache_read 1 --cache_path /mnt/data/owen411/code/hydro-spdb-dl/example/gages/cache-3557sites-19900101_20000101_20000101_20100101-30attr-7forcing-res_dor_hist --train_period 1990-01-01 2000-01-01 --test_period 2000-01-01 2010-01-01 --scaler DapengScaler --data_loader KernelFlowDataModel --train_epoch 300 --save_epoch 50 --batch_size 100 --rho 365 --var_o {\"RES_DOR_HIST\":{\"bins\":50}} --var_c DRAIN_SQKM ELEV_MEAN_M_BASIN SLOPE_PCT DEVNLCD06 FORESTNLCD06 PLANTNLCD06 WATERNLCD06 SNOWICENLCD06 BARRENNLCD06 SHRUBNLCD06 GRASSNLCD06 WOODYWETNLCD06 EMERGWETNLCD06 AWCAVE PERMAVE RFACT ROCKDEPAVE GEOL_REEDBUSH_DOM GEOL_REEDBUSH_DOM_PCT STREAMS_KM_SQ_KM NDAMS_2009 STOR_NOR_2009 RAW_DIS_NEAREST_MAJ_DAM CANALS_PCT RAW_DIS_NEAREST_CANAL FRESHW_WITHDRAWAL POWER_SUM_MW PDEN_2000_BLOCK ROADS_KM_SQ_KM IMPNLCD06
# python gages3557_analysis.py --sub gages/cache-2909sites-19900101_20000101_20000101_20100101-35attr-7forcing --download 0 --train_mode 0 --model_name KaiTlLSTM --model_param {\"seq_length\":365\,\"n_time_series\":42\,\"input_seq_len\":37\,\"output_seq_len\":1\,\"hidden_states\":256\,\"num_layers\":1\,\"bias\":true\,\"batch_size\":100\,\"probabilistic\":false} --opt Adadelta --loss_func RMSESum --hidden_size 256 --rs 1234 --cache_write 1 --train_period 1990-01-01 2000-01-01 --test_period 2000-01-01 2010-01-01 --scaler DapengScaler --data_loader StreamflowDataModel --weight_path_add {\"freeze_params\":[\"linearIn.bias\"\,\"linearIn.weight\"\,\"linearOut.bias\"\,\"linearOut.weight\"\,\"lstm.b_hh\"\,\"lstm.b_ih\"\,\"lstm.w_hh\"\,\"lstm.w_ih\"]} --weight_path /mnt/data/owen411/code/hydro-spdb-dl/example/gages/exp2/05_April_202105_47AM_model.pth --continue_train 1 --train_epoch 300 --save_epoch 50 --var_c DRAIN_SQKM ELEV_MEAN_M_BASIN SLOPE_PCT DEVNLCD06 FORESTNLCD06 PLANTNLCD06 WATERNLCD06 SNOWICENLCD06 BARRENNLCD06 SHRUBNLCD06 GRASSNLCD06 WOODYWETNLCD06 EMERGWETNLCD06 AWCAVE PERMAVE RFACT ROCKDEPAVE GEOL_REEDBUSH_DOM GEOL_REEDBUSH_DOM_PCT STREAMS_KM_SQ_KM NDAMS_2009 STOR_NOR_2009 RAW_DIS_NEAREST_MAJ_DAM CANALS_PCT RAW_DIS_NEAREST_CANAL FRESHW_WITHDRAWAL POWER_SUM_MW PDEN_2000_BLOCK ROADS_KM_SQ_KM IMPNLCD06 DOR DAM_MAIN_PURPOSE DIVERSION DAM_GAGE_DIS_VAR DAM_STORAGE_STD --n_feature 42 --gage_id_file /mnt/data/owen411/code/hydro-spdb-dl/example/2909basins_NSE.csv
# python gages3557_analysis.py --sub gages/exp14 --cache_read 1 --cache_path /mnt/data/owen411/code/hydro-spdb-dl/example/gages/cache-2909sites-19900101_20000101_20000101_20100101-35attr-7forcing --download 0 --model_name KaiTlLSTM --model_param {\"seq_length\":365\,\"n_time_series\":42\,\"input_seq_len\":37\,\"output_seq_len\":1\,\"hidden_states\":256\,\"num_layers\":1\,\"bias\":true\,\"batch_size\":100\,\"probabilistic\":false} --opt Adadelta --loss_func RMSESum --hidden_size 256 --rs 1234 --train_period 1990-01-01 2000-01-01 --test_period 2000-01-01 2010-01-01 --scaler DapengScaler --data_loader StreamflowDataModel --weight_path /mnt/data/owen411/code/hydro-spdb-dl/example/gages/exp2/05_April_202105_47AM_model.pth --continue_train 1 --train_epoch 300 --save_epoch 50 --var_c DRAIN_SQKM ELEV_MEAN_M_BASIN SLOPE_PCT DEVNLCD06 FORESTNLCD06 PLANTNLCD06 WATERNLCD06 SNOWICENLCD06 BARRENNLCD06 SHRUBNLCD06 GRASSNLCD06 WOODYWETNLCD06 EMERGWETNLCD06 AWCAVE PERMAVE RFACT ROCKDEPAVE GEOL_REEDBUSH_DOM GEOL_REEDBUSH_DOM_PCT STREAMS_KM_SQ_KM NDAMS_2009 STOR_NOR_2009 RAW_DIS_NEAREST_MAJ_DAM CANALS_PCT RAW_DIS_NEAREST_CANAL FRESHW_WITHDRAWAL POWER_SUM_MW PDEN_2000_BLOCK ROADS_KM_SQ_KM IMPNLCD06 DOR DAM_MAIN_PURPOSE DIVERSION DAM_GAGE_DIS_VAR DAM_STORAGE_STD --n_feature 42 --gage_id_file /mnt/data/owen411/code/hydro-spdb-dl/example/2909basins_NSE.csv
# python gages3557_analysis.py --sub gages/exp16 --cache_read 1 --cache_path /mnt/data/owen411/code/hydro-spdb-dl/example/gages/cache-2909sites-19900101_20000101_20000101_20100101-35attr-7forcing --download 0 --model_name KaiTlLSTM --model_param {\"seq_length\":365\,\"n_time_series\":42\,\"input_seq_len\":37\,\"output_seq_len\":1\,\"hidden_states\":256\,\"num_layers\":1\,\"bias\":true\,\"batch_size\":100\,\"probabilistic\":false} --opt Adadelta --loss_func RMSESum --hidden_size 256 --rs 1234 --train_period 1990-01-01 2000-01-01 --test_period 2000-01-01 2010-01-01 --scaler DapengScaler --data_loader StreamflowDataModel --weight_path /mnt/data/owen411/code/hydro-spdb-dl/example/gages/exp2/05_April_202105_47AM_model.pth --weight_path_add {\"freeze_params\":[\"linearIn.bias\"\,\"linearIn.weight\"\,\"linearOut.bias\"\,\"linearOut.weight\"\,\"lstm.b_hh\"\,\"lstm.b_ih\"\,\"lstm.w_hh\"\,\"lstm.w_ih\"]} --continue_train 1 --train_epoch 300 --save_epoch 50 --var_c DRAIN_SQKM ELEV_MEAN_M_BASIN SLOPE_PCT DEVNLCD06 FORESTNLCD06 PLANTNLCD06 WATERNLCD06 SNOWICENLCD06 BARRENNLCD06 SHRUBNLCD06 GRASSNLCD06 WOODYWETNLCD06 EMERGWETNLCD06 AWCAVE PERMAVE RFACT ROCKDEPAVE GEOL_REEDBUSH_DOM GEOL_REEDBUSH_DOM_PCT STREAMS_KM_SQ_KM NDAMS_2009 STOR_NOR_2009 RAW_DIS_NEAREST_MAJ_DAM CANALS_PCT RAW_DIS_NEAREST_CANAL FRESHW_WITHDRAWAL POWER_SUM_MW PDEN_2000_BLOCK ROADS_KM_SQ_KM IMPNLCD06 DOR DAM_MAIN_PURPOSE DIVERSION DAM_GAGE_DIS_VAR DAM_STORAGE_STD --n_feature 42 --gage_id_file /mnt/data/owen411/code/hydro-spdb-dl/example/2909basins_NSE.csv
# python gages3557_analysis.py --sub gages/exp17 --gage_id_file /mnt/data/owen411/code/hydro-spdb-dl/example/3557basins_ID_NSE_DOR.csv --download 0 --model_name DapengCNNLSTM --opt Adadelta --loss_func RMSESum --rs 123 --model_param {\"n_kernel\":[10\,5]\,\"kernel_size\":[3\,3]\,\"stride\":[2\,1]\,\"nx\":37\,\"ny\":1\,\"nobs\":50\,\"hidden_size\":256\,\"dr\":0.5\,\"cnn_dr\":0.5\,\"cat_first\":false} --cache_read 1 --cache_path /mnt/data/owen411/code/hydro-spdb-dl/example/gages/cache-3557sites-19900101_20000101_20000101_20100101-30attr-7forcing-res_dor_hist --train_period 1990-01-01 2000-01-01 --test_period 2000-01-01 2010-01-01 --scaler DapengScaler --data_loader KernelFlowDataModel --train_epoch 300 --save_epoch 50 --batch_size 100 --rho 365 --var_o {\"RES_DOR_HIST\":{\"bins\":50}} --var_c DRAIN_SQKM ELEV_MEAN_M_BASIN SLOPE_PCT DEVNLCD06 FORESTNLCD06 PLANTNLCD06 WATERNLCD06 SNOWICENLCD06 BARRENNLCD06 SHRUBNLCD06 GRASSNLCD06 WOODYWETNLCD06 EMERGWETNLCD06 AWCAVE PERMAVE RFACT ROCKDEPAVE GEOL_REEDBUSH_DOM GEOL_REEDBUSH_DOM_PCT STREAMS_KM_SQ_KM NDAMS_2009 STOR_NOR_2009 RAW_DIS_NEAREST_MAJ_DAM CANALS_PCT RAW_DIS_NEAREST_CANAL FRESHW_WITHDRAWAL POWER_SUM_MW PDEN_2000_BLOCK ROADS_KM_SQ_KM IMPNLCD06
# python gages3557_analysis.py --sub gages/exp18 --gage_id_file /mnt/data/owen411/code/hydro-spdb-dl/example/3557basins_ID_NSE_DOR.csv --download 0 --model_name DapengCNNLSTM --opt Adadelta --loss_func RMSESum --rs 12345 --model_param {\"n_kernel\":[10\,5]\,\"kernel_size\":[3\,3]\,\"stride\":[2\,1]\,\"nx\":37\,\"ny\":1\,\"nobs\":50\,\"hidden_size\":256\,\"dr\":0.5\,\"cnn_dr\":0.5\,\"cat_first\":false} --cache_read 1 --cache_path /mnt/data/owen411/code/hydro-spdb-dl/example/gages/cache-3557sites-19900101_20000101_20000101_20100101-30attr-7forcing-res_dor_hist --train_period 1990-01-01 2000-01-01 --test_period 2000-01-01 2010-01-01 --scaler DapengScaler --data_loader KernelFlowDataModel --train_epoch 300 --save_epoch 50 --batch_size 100 --rho 365 --var_o {\"RES_DOR_HIST\":{\"bins\":50}} --var_c DRAIN_SQKM ELEV_MEAN_M_BASIN SLOPE_PCT DEVNLCD06 FORESTNLCD06 PLANTNLCD06 WATERNLCD06 SNOWICENLCD06 BARRENNLCD06 SHRUBNLCD06 GRASSNLCD06 WOODYWETNLCD06 EMERGWETNLCD06 AWCAVE PERMAVE RFACT ROCKDEPAVE GEOL_REEDBUSH_DOM GEOL_REEDBUSH_DOM_PCT STREAMS_KM_SQ_KM NDAMS_2009 STOR_NOR_2009 RAW_DIS_NEAREST_MAJ_DAM CANALS_PCT RAW_DIS_NEAREST_CANAL FRESHW_WITHDRAWAL POWER_SUM_MW PDEN_2000_BLOCK ROADS_KM_SQ_KM IMPNLCD06
if __name__ == '__main__':
    print("Begin\n")
    gages_dir = [os.path.join(definitions.DATASET_DIR, "gages_pro"),
                 os.path.join(definitions.DATASET_DIR, "gages"),
                 os.path.join(definitions.DATASET_DIR, "nid"),
                 os.path.join(definitions.DATASET_DIR, "gridmet")]
    dataset_name = "GAGES_PRO"
    config = default_config_file(gages_dir, dataset_name)
    cmd_args = cmd()
    main(config, cmd_args)
    print("End\n")
